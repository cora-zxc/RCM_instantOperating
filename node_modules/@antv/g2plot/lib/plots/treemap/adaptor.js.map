{"version":3,"file":"adaptor.js","sourceRoot":"","sources":["../../../src/plots/treemap/adaptor.ts"],"names":[],"mappings":"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","sourcesContent":["import { polygon as basePolygon } from '../../adaptor/geometries/polygon';\nimport { Params } from '../../core/adaptor';\nimport { interaction as commonInteraction, animation, theme, legend, annotation, tooltip } from '../../adaptor/common';\nimport { flow, deepAssign } from '../../utils';\nimport {\n  transformData,\n  findInteraction,\n  enableInteraction,\n  getFommatInteractions,\n  getAdjustAppendPadding,\n} from './utils';\nimport { TreemapOptions } from './types';\n\n/**\n * 获取默认 option\n * @param params\n */\nfunction defaultOptions(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { options } = params;\n  const { colorField } = options;\n\n  return deepAssign(\n    {\n      options: {\n        // 默认按照 name 字段对颜色进行分类\n        colorField: 'name',\n        rectStyle: {\n          lineWidth: 1,\n          stroke: '#fff',\n        },\n        hierarchyConfig: {\n          tile: 'treemapSquarify',\n        },\n        label: {\n          fields: ['name'],\n          layout: {\n            type: 'limit-in-shape',\n          },\n        },\n        tooltip: {\n          showMarkers: false,\n          showTitle: false,\n          fields: ['name', 'value', colorField, 'path'],\n          formatter: (data) => {\n            return {\n              name: data.name,\n              value: data.value,\n            };\n          },\n        },\n      },\n    },\n    params\n  );\n}\n\n/**\n * 字段\n * @param params\n */\nfunction geometry(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart, options } = params;\n  const { color, colorField, rectStyle, hierarchyConfig } = options;\n\n  const data = transformData({\n    data: options.data,\n    colorField: options.colorField,\n    enableDrillDown: enableInteraction(options.interactions, 'treemap-drill-down'),\n    hierarchyConfig,\n  });\n\n  chart.data(data);\n\n  // geometry\n  basePolygon(\n    deepAssign({}, params, {\n      options: {\n        xField: 'x',\n        yField: 'y',\n        seriesField: colorField,\n        rawFields: ['value'],\n        polygon: {\n          color,\n          style: rectStyle,\n        },\n      },\n    })\n  );\n\n  // 做一个反转，这样配合排序，可以将最大值放到左上角，最小值放到右下角\n  chart.coordinate().reflect('y');\n\n  return params;\n}\n\n/**\n * 坐标轴\n * @param params\n */\nfunction axis(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart } = params;\n  chart.axis(false);\n  return params;\n}\n\n/**\n * Interaction 配置\n * @param params\n */\nexport function interaction(params: Params<TreemapOptions>): Params<TreemapOptions> {\n  const { chart, options } = params;\n  const { interactions, hierarchyConfig } = options;\n\n  commonInteraction({\n    chart,\n    options: {\n      interactions: getFommatInteractions(interactions, hierarchyConfig),\n    },\n  });\n\n  // 适配 view-zoom\n  const viewZoomInteraction = findInteraction(interactions, 'view-zoom');\n\n  if (viewZoomInteraction) {\n    // 开启缩放 interaction 后，则阻止默认滚动事件，避免整个窗口的滚动\n    if (viewZoomInteraction.enable !== false) {\n      chart.getCanvas().on('mousewheel', (ev) => {\n        ev.preventDefault();\n      });\n    } else {\n      // 手动关闭后，清除。仅对声明 viewZoomInteraction 的清除。\n      chart.getCanvas().off('mousewheel');\n    }\n  }\n\n  // 适应下钻交互面包屑\n  const enableDrillInteraction = enableInteraction(interactions, 'treemap-drill-down');\n  if (enableDrillInteraction) {\n    // 为面包屑在底部留出 25px 的空间\n    chart.appendPadding = getAdjustAppendPadding(chart.appendPadding);\n  }\n  return params;\n}\n\n/**\n * 矩形树图\n * @param chart\n * @param options\n */\nexport function adaptor(params: Params<TreemapOptions>) {\n  return flow(defaultOptions, geometry, axis, theme, legend, tooltip, interaction, animation, annotation())(params);\n}\n"]}